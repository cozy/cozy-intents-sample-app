!function(e){var t={};function n(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);const o=e=>t=>n=>({method:"POST",headers:{Authorization:`Bearer ${e}`,"content-type":"application/json"},credentials:"include",body:JSON.stringify({data:{type:"io.cozy.intents",attributes:{action:t,type:n,data:{},permissions:[]}}})}),s=e=>{if(e.ok)return e.json();throw new Error("Network response was not ok.")},i=e=>{const{attributes:t,links:n,id:o,meta:{rev:s},type:i}=e.data;return{_id:o,_rev:s,_type:i,attributes:t,links:n,relations:function(e){}}},r=e=>{for(;e.firstChild;)e.removeChild(e.firstChild)},a=e=>{"https://secsiproject-qwanttest.mycozy.cloud/"===e.origin?console.log("internal message received"):"https://secsiproject-drive.mycozy.cloud"===e.origin&&(e.data.type.includes(":ready")?console.log("intents is ready"):e.data.type.includes(":data")&&(console.log("here are the results",e.data),(e=>{window.parent.postMessage(e,"chrome-extension://nnfkahljlkaemdjdgbhklabekcikffcc");var t=document.getElementById("results");r(t),e.forEach(e=>{const n=document.createElement("li");n.innerText=e.title,t.appendChild(n)})})(e.data.suggestions)))},c=e=>{console.error((e=>`There has been a problem with your fetch operation: ${e.message}`)(e))},d=e=>({query:e,id:(new Date).getTime()}),l=e=>{const t=(e=>({url:`//${e.cozyDomain}`,token:e.cozyToken}))(e);return((e,t,n,r)=>window.fetch(`${e}/intents`,o(t)(n)(r)).then(s).then(i))(t.url,t.token,"OPEN","io.cozy.suggestions")};({start:function(){this.bindEvents(),console.log("Application is startingâ€¦")},bindEvents:function(){document.addEventListener("DOMContentLoaded",this.onDOMContentLoaded.bind(this),!1),window.addEventListener("message",a),window.addEventListener("message",function(e){if("chrome-extension://nnfkahljlkaemdjdgbhklabekcikffcc"===e.origin){console.log("MESSAGE: "+e.data+" FROM: "+e.origin);const t=this.targetWindows,n=d(e.data);t.forEach(e=>{e.postMessage(n,"https://secsiproject-drive.mycozy.cloud")})}}.bind(this)),document.getElementById("message").addEventListener("input",this.onInput.bind(this))},onInput:function(e){const t=this.targetWindows,n=(e=>e.target.value)(e),o=d(n);t.forEach(e=>{e.postMessage(o,"https://secsiproject-drive.mycozy.cloud")})},onDOMContentLoaded:function(){const{dataset:e}=document.getElementById("cozy");l(e).then(e=>{const{attributes:{services:t},_id:n}=e;this.targetWindows=t.map(e=>{const{href:t,slug:n}=e;return((e,t)=>{const n=document.createElement("iframe");return n.setAttribute("src",e),n.setAttribute("style","display: none"),n.onload=function(e){console.log(`iframe ${t} is loaded`)},document.getElementById("iframes").appendChild(n),n.contentWindow})(t,n)})}).catch(c)}}).start()}]);