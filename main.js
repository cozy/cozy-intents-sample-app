!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);const o=["chrome-extension://manlhohdnggdocclckddhnojeiipgjbc","chrome-extension://ffcmikbhfbjcioofacoggoppaccmeiko","chrome-extension://omdoimbgmagbacgjjclnpajdmfdafkac","chrome-extension://kneaonmmmlfahbfdbkgfmabkllccpcdk","chrome-extension://ikomcpajhcnbdfaimnbfaedombofdhfp"],i=e=>t=>n=>({method:"POST",headers:{Authorization:`Bearer ${e}`,"content-type":"application/json"},credentials:"include",body:JSON.stringify({data:{type:"io.cozy.intents",attributes:{action:t,type:n,data:{},permissions:[]}}})}),s=e=>{if(e.ok)return e.json();throw new Error("Network response was not ok.")},r=e=>{const{attributes:t,links:n,id:o,meta:{rev:i},type:s}=e.data;return{_id:o,_rev:i,_type:s,attributes:t,links:n,relations:function(e){}}},a=e=>{for(;e.firstChild;)e.removeChild(e.firstChild)},c=e=>{"https://cortest-qwanttest.mycozy.cloud/"===e.origin?console.log("internal message received"):"https://cortest-drive.mycozy.cloud"===e.origin&&(e.data.type.includes(":ready")?console.log("intents is ready"):e.data.type.includes(":data")&&(console.log("here are the results",e.data),(e=>{console.log("RESULTS TO WEBEXT:",e),o.forEach(function(t){window.parent.postMessage(e,t)});var t=document.getElementById("results");a(t),e.forEach(e=>{const n=document.createElement("li");n.innerText=e.title,t.appendChild(n)})})(e.data.suggestions)))},d=e=>{console.error((e=>`There has been a problem with your fetch operation: ${e.message}`)(e))},l=e=>({query:e,id:(new Date).getTime()}),u=e=>{const t=(e=>({url:`//${e.cozyDomain}`,token:e.cozyToken}))(e);return((e,t,n,o)=>window.fetch(`${e}/intents`,i(t)(n)(o)).then(s).then(r))(t.url,t.token,"OPEN","io.cozy.suggestions")};({start:function(){this.bindEvents(),console.log("Application is startingâ€¦")},bindEvents:function(){document.addEventListener("DOMContentLoaded",this.onDOMContentLoaded.bind(this),!1),window.addEventListener("message",c),window.addEventListener("message",function(e){if(o.includes(e.origin)){console.log("WEBEXT MESSAGE: "+e.data+" FROM: "+e.origin);const t=this.targetWindows,n=l(e.data);t.forEach(e=>{e.postMessage(n,"https://cortest-drive.mycozy.cloud")})}}.bind(this)),document.getElementById("message").addEventListener("input",this.onInput.bind(this))},onInput:function(e){const t=this.targetWindows,n=(e=>e.target.value)(e),o=l(n);t.forEach(e=>{e.postMessage(o,"https://cortest-drive.mycozy.cloud")})},onDOMContentLoaded:function(){const{dataset:e}=document.getElementById("cozy");u(e).then(e=>{const{attributes:{services:t},_id:n}=e;this.targetWindows=t.map(e=>{const{href:t,slug:n}=e;return((e,t)=>{const n=document.createElement("iframe");return n.setAttribute("src",e),n.setAttribute("style","display: none"),n.onload=function(e){console.log(`iframe ${t} is loaded`)},document.getElementById("iframes").appendChild(n),n.contentWindow})(t,n)})}).catch(d)}}).start()}]);